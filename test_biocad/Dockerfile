# Используйте официальный образ Node.js как базовый для сборки
FROM node:14 as builder

# Установите рабочий каталог для этапа сборки
WORKDIR /usr/src/app

# Скопируйте файлы package.json и package-lock.json в рабочий каталог
COPY package*.json ./

# Установите зависимости проекта
RUN npm install

# Скопируйте исходный код приложения в контейнер
COPY . .

# Сборка проекта (если требуется)

# Используйте легковесный образ Node.js для запуска
FROM node:14-slim

# Установите рабочий каталог для запускаемого контейнера
WORKDIR /usr/src/app

# Скопируйте только необходимые файлы из предыдущего этапа сборки
COPY --from=builder /usr/src/app .

# Откройте порт 32777 для доступа извне контейнера
EXPOSE 32777

# Запустите приложение при старте контейнера
CMD [ "node", "app.js" ]
